name: Deploy to GitHub Pages

on:
  # ç•¶æ¨é€åˆ° main åˆ†æ”¯æ™‚è§¸ç™¼
  push:
    branches: ["main"]

  # å…è¨±åœ¨ Actions é é¢æ‰‹å‹•é»æ“ŠæŒ‰éˆ•è§¸ç™¼
  workflow_dispatch:

# è¨­å®šæ¬Šé™ï¼Œå…è¨± Action ä¿®æ”¹ Repository (ç‚ºäº†æ¨é€ gh-pages)
permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. æª¢å‡ºç¨‹å¼ç¢¼
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      # 2. è¨­å®š Node.js ç’°å¢ƒ
      - name: Setup Node.js âš™ï¸
        uses: actions/setup-node@v4
        with:
          node-version: "20" # å»ºè­°ä½¿ç”¨ LTS ç‰ˆæœ¬
          cache: 'npm'

      # 3. å®‰è£ä¾è³´
      - name: Install Dependencies ğŸ”§
        run: npm ci

      # 4. å»ºç½®å°ˆæ¡ˆ (æœƒç”Ÿæˆ out è³‡æ–™å¤¾)
      - name: Build ğŸ—ï¸
        run: npm run build

      # 5. ä¿®æ­£ GitHub Pages çš„ Jekyll å•é¡Œ
      # Next.js ç”Ÿæˆçš„ _next è³‡æ–™å¤¾æœƒè¢« GitHub Pages é è¨­çš„ Jekyll å¿½ç•¥
      # å»ºç«‹ .nojekyll æª”æ¡ˆå¯ä»¥é—œé–‰é€™å€‹è¡Œç‚º
      - name: Create .nojekyll file
        run: touch out/.nojekyll

      # 6. éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯
      - name: Deploy ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: out # Next.js export é è¨­è¼¸å‡ºçš„è³‡æ–™å¤¾åç¨±
          branch: gh-pages # ç›®æ¨™åˆ†æ”¯